buildscript {
    ext {
        kotlin_version = '1.5.+'
    }

    repositories {
        mavenCentral()

        // gradle plugin repository
        maven {
            url "https://plugins.gradle.org/m2/"
        }
    }

    dependencies {
        classpath group: 'org.jetbrains.kotlin', name: 'kotlin-gradle-plugin', version: kotlin_version
        classpath group: 'gradle.plugin.com.github.johnrengelman', name: 'shadow', version: '7.1.0'
    }
}

apply plugin: 'kotlin'
// build fat jars
apply plugin: 'com.github.johnrengelman.shadow'

// change build output to avoid name clashes with shell script 'build'
buildDir('out')

repositories {
    mavenCentral()
}

dependencies {
    implementation 'org.jetbrains.kotlinx:kotlinx-cli:0.3.3'
}

// define JVM target version
compileKotlin {
    kotlinOptions {
        jvmTarget = '16'
    }
}

java {
    targetCompatibility = JavaVersion.VERSION_16
}

jar {
    archivesBaseName = "compiler"
    manifest {
        attributes 'Implementation-Title': 'MiniJavaCompiler',
                'Implementation-Version': archiveVersion,
                'Main-Class': 'edu.kit.compiler.MainKt'
    }
}